## Про скрипт `wait-for-it.sh`

```shell
#!/bin/sh
```
Эта строка указывает системе, что файл - это скрипт на языке sh.

```shell
set -e 
```
Эта команда включает "строгий" режим выполнения скрипта, который означает, что скрипт завершит свою работу, если какая-либо команда в нем вернет ненулевой код возврата. В данном случае, если какая-либо команда не выполнится успешно, скрипт прекратит свою работу.

```shell
host="$1"
port="$2"
shift 2
cmd="$@"
```

`host="$1"` - присваивает переменной host значение первого аргумента, переданного скрипту при его вызове.

`port="$2"` - присваивает переменной port значение второго аргумента, переданного скрипту.

`shift 2` - сдвигает аргументы влево на две позиции. Теперь $1 становится тем, что было $3, $2 - тем, что было $4, и так далее. Это делается для того, чтобы получить доступ к оставшимся аргументам.

`cmd="$@"` - присваивает переменной cmd все оставшиеся аргументы после сдвига. Это будет команда, которую нужно выполнить после успешного ожидания порта.

```shell
until nc -z "$host" "$port"; do
  >&2 echo "Waiting for $host:$port to become available..."
  sleep 1
done
```

`until nc -z "$host" "$port"; do` - это цикл until, который будет выполняться до тех пор, пока порт, указанный в переменных host и port, не станет доступным. 

`nc -z "$host" "$port"` - проверяет доступность порта, и цикл будет продолжаться, пока порт недоступен.

**Важно!** Скрипт [wait-for-it.sh](wait-for-it.sh) использует утилиту `nc`. Таким образом при сборке образа контейнера 
с тестами может потребоваться установить пакет содержащий эту утилиту.
Например, если в качестве базового образа для контейнера с тестами мы используем `python:latest`, то по-умолчанию в рамках контейнера созданного на основе этого образа не будет утилиты `nc`:
```shell
root@65536792de98:/tests# nc
bash: nc: command not found
```
Таким образом для работы с этой утилитой понадобится дополнительно установить пакет [netcat-traditional](https://manpages.debian.org/unstable/netcat-traditional/nc.traditional.1.en.html).
Для этого надо в `Dockerfile` образа с тестами добавить директиву:
```dockerfile
RUN apt update && apt install -y netcat-traditional
```
После сборки образа внутри контейнера с тестами утилита `nc` будет доступна:
```shell
root@65536792de98:/tests# nc -h
[v1.10-46]
connect to somewhere:	nc [-options] hostname port[s] [ports] ... 
listen for inbound:	nc -l -p port [-options] [hostname] [port]
...
```


`>&2 echo "Waiting for $host:$port to become available..."` - эта команда выводит сообщение ожидания на стандартный поток ошибок (stderr), `>&2` перенаправляет вывод на stderr.

`sleep 1` - приостанавливает выполнение скрипта на 1 секунду перед следующей итерацией цикла.

```shell
>&2 echo "$host:$port is available, executing command: $cmd"
exec $cmd
```

`>&2 echo "$host:$port is available, executing command: $cmd"` - выводит сообщение об успешном завершении ожидания порта и сообщает о том, что будет выполнена команда.

`exec $cmd` - запускает команду, переданную в аргументах после успешного ожидания порта. Когда команда завершит свое выполнение, скрипт также завершит свою работу.

Таким образом, весь скрипт `wait-for-it.sh` предназначен для ожидания доступности порта на указанном хосте и затем выполнения команды после успешного ожидания.
